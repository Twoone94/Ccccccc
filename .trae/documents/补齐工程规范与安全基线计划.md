## 目标
- 建立统一的工程规范（Lint、格式化、类型检查、提交流程、测试与CI）。
- 强化桌面应用安全（Electron 安全选项、CSP、密钥与会话存储）。
- 统一开发运行配置（端口、环境变量），规范资源与样式使用。

## 实施步骤

### 1. 统一运行配置
- 统一开发端口到 `5174`：Electron 主进程改为读取环境变量（如 `DEV_SERVER_PORT`），默认回退 `5174`（当前 `electron/main.cjs:29` 为 `5186`）。
- 在开发脚本中传递端口，确保 Vite 与 Electron 一致（`package.json:scripts`）。
- 预览端口统一，避免与开发冲突；通过脚本参数或环境变量控制。

### 2. 基础工程规范
- 新增 ESLint（TypeScript + React + Hooks + JSX a11y），添加 `npm run lint` 脚本。
- 新增 Prettier 配置与 `npm run format` 脚本，统一代码风格。
- 新增 `.editorconfig`（缩进、换行、编码）确保不同编辑器一致性。
- 新增 `npm run typecheck`（`tsc --noEmit`），与 `tsconfig.json` 严格模式对齐。
- 新增 `.gitignore`（`node_modules/`、`dist/`、`*.log`、`.env*` 等）。

### 3. 提交流程与质量闸
- 引入 `commitlint`（约束提交信息），`husky`（Git 钩子），`lint-staged`（提交前 Lint/格式化）。
- 设置提交前钩子：类型检查 + Lint + 格式化 + 轻量测试（变更文件）。

### 4. 测试与覆盖率
- 引入 `vitest` 与 `@testing-library/react`，新增 `npm run test`、`test:watch`、`coverage`。
- 优先为以下模块补充基础测试：
  - `src/store/chat.ts`：load/save/session CRUD。
  - `src/components/ui/Toolbar.tsx`、`src/components/ui/shadcn/Input.tsx`：渲染与交互基础。
  - `src/services/ai/gemini.ts`：在不访问外网的前提下，通过依赖注入/Mock 验证参数与流程分支。

### 5. CI 工作流
- 新增 GitHub Actions：Node 环境下执行 `install → typecheck → lint → test → build`。
- 可选：在主分支强制 CI 通过后才允许合并。

### 6. Electron 安全基线
- 显式开启安全选项：`contextIsolation: true`、`sandbox: true`、`nodeIntegration: false`（`electron/main.cjs:webPreferences`）。
- 保持已有外链限制（`will-navigate`/`setWindowOpenHandler`）并完善白名单。
- 新增 CSP（在 `index.html` 注入严格 `meta`），限制脚本与资源来源。

### 7. 密钥与会话存储
- 将 API 密钥从渲染进程 `localStorage` 迁移到主进程安全存储（如 `keytar` 或加密存储）。
- 通过 `preload` 暴露受限的读取/写入接口，杜绝直接在渲染进程读写敏感信息。
- 会话数据（非敏感）保留在渲染端，但提供“清除/导出”能力与体积上限策略。

### 8. 环境变量与配置
- 新增 `.env.example` 与 `.env.local`；前端使用 `VITE_*` 前缀（如 `VITE_GEMINI_API_KEY`），Electron 使用 `process.env.*`。
- 在 `vite.config.ts` 与 Electron 主进程统一读取端口/URL 等关键配置。

### 9. 资源与样式规范
- 运行时资源从 `.figma` 迁移至 `public/` 或 `src/assets/`，修改所有引入路径，避免设计稿目录进入打包产物。
- 推进内联样式向 Tailwind 类/CSS 变量迁移，统一设计令牌（`src/styles/tailwind.css:18-37` 已有变量）。
- 引入 ESLint 自定义规则或简单脚本，阻止 `.figma` 路径在源码中出现。

### 10. 可访问性与国际化
- 启用 `eslint-plugin-jsx-a11y` 并修复常见问题（装饰性图标 `aria-hidden`，为交互元素添加语义/标签）。
- 初步接入 i18n（如 `i18next`），集中管理文案，实现中英文切换与占位变量。

### 11. 性能与维护
- 将 `ProjectInterface` 的 500ms 轮询调整为事件驱动或降频，优先在焦点/显隐/保存动作时同步（`src/pages/ProjectInterface.tsx:159-172`）。
- 统一日志层与等级，替换散落的 `console.*`，为关键服务增加错误上报接口。

## 交付物
- 新增与更新的配置文件（ESLint、Prettier、EditorConfig、GitHub Actions、`.env.example`、`.gitignore`）。
- 调整后的 Electron 主进程安全与端口配置。
- 基础测试与覆盖率报表，CI 绿色通过。
- 资源路径与样式统一的第一批改造。

## 验证方式
- 本地执行：`typecheck`、`lint`、`format`、`test`、`build` 全部通过。
- Electron 开发模式：统一端口后成功启动并加载页面；安全选项生效（通过 DevTools 与日志验证）。
- CI：推送到远程后，工作流全部成功。

## 需要确认
- 是否将端口统一为 `5174`，并以环境变量驱动 Electron 主进程？
- 是否采用主进程安全存储（如 `keytar`）来管理 API 密钥？
- 是否优先迁移 `.figma` 资源到 `public/`，分批修正引用？
